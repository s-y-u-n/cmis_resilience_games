# Buldyrev2010 の実世界モデル整理

このファイルでは、Buldyrev2010 論文で想定されている
実世界の問題設定（インフラ・ネットワーク・データ）を整理する。

## 1. 対象インフラ / システム

### 1.1 イタリア大停電を題材にしたインフラ

Buldyrev2010 論文は、相互依存ネットワークの現実例として

- 2003 年 9 月 28 日に発生した **イタリアの大規模停電**（electrical blackout in Italy）

を挙げている。ここでは

- **電力ネットワーク**（発電所や変電所を結ぶ送電網）
- **インターネット通信ネットワーク**（SCADA: supervisory control and data acquisition 用の通信網）

の 2 つが相互に依存するシステムとして扱われる。

論文中の記述を要約すると：

- 電力系統の停止 → それに依存する通信ノードの停止 → さらに電力系統側の停電拡大
- という「同時多発的な故障（concurrent malfunction）」が連鎖した事例として位置づけられている。

### 1.2 地理的範囲と時間スケール

- 地理的範囲:
  - イタリア全土の電力ネットワークと、それに対応するインターネット通信ネットワーク。
  - 図 1 では、イタリア地図上に電力ネットワークのノードを配置し、
    その上空に通信ノードを描画している。
- 時間スケール:
  - モデルは **静的なネットワーク構造**を前提にした「ステップ的な故障伝播」の描写に集中しており、
    動的制御や運用ルールの時間発展までは扱っていない。
  - カスケードは「ステップ 1, 2, 3, …」と離散ステップで表現される。

## 2. ネットワークとしての表現

### 2.1 ノードの意味

論文では、イタリアの実データから構築された 2 つのネットワークを用いて、
イタリア大停電のカスケードを図示している。

- 電力ネットワーク（power network）
  - ノード: 発電所あるいは電力ノード（power stations）。
  - それぞれが地理的位置（地図上の座標）を持つ。
- インターネットネットワーク（Internet / SCADA network）
  - ノード: インターネットサーバ／通信ノード（communication nodes）。
  - こちらも地理的な位置を持ち、電力ノードの上空に投影される形で図示されている。

本リポジトリ側で用意する `italy_power_nodes.csv`, `italy_comm_nodes.csv` などでは、

- `power_id`, `comm_id` といった整数 ID に加え、
- `x`, `y` 等の座標列（地理位置）が保持される設計になっている（`build_real_italy_system` の docstring より）。

### 2.2 エッジの意味

- 電力ネットワーク内のエッジ（A-links）
  - 発電所・変電所などの電力ノード同士を結ぶ **送電線** を表す。
  - 論文では無向リンクとして扱われ、次数分布 \(P_A(k)\) のもとでランダム（もしくは実データ）に接続される。
- 通信ネットワーク内のエッジ（B-links）
  - 通信ノード間の **通信リンク**（インターネット接続・専用線など）を表す。
  - 同様に無向リンクとして扱われ、次数分布 \(P_B(k)\) を持つ。

論文は主に「ネットワークの連結性」と「ノードの生死」に着目しており、

- リンク容量・電力潮流・遅延時間などの連続量は明示的にはモデル化しない。
- 代わりに「連結成分（giant component, mutually connected component）」というグラフ理論的な指標で
  システムの機能性を表現している。

### 2.3 レイヤ構造

- レイヤ A:
  - 電力ネットワーク（power grid）。
  - ノード数 N、次数分布 \(P_A(k)\)。
- レイヤ B:
  - 通信ネットワーク（Internet / SCADA network）。
  - ノード数 N、次数分布 \(P_B(k)\)。

両レイヤのノードは、1:1 の依存関係によってペアになっている（次節）。

## 3. 依存関係のモデリング

### 3.1 1:1 の双方向依存

Buldyrev2010 では、電力ネットワークと通信ネットワークの依存関係を
次のような 1:1 の双方向リンクとしてモデル化する。

- 各電力ノード \(A_i\) は、ちょうど 1 つの通信ノード \(B_j\) に依存する。
- 各通信ノード \(B_j\) も、ちょうど 1 つの電力ノード \(A_i\) に依存する。
- これを **bidirectional link** \(A_i \Leftrightarrow B_i\) として表現し、
  ネットワーク A と B のノード集合の間に 1:1 対応を与える。

意味的には：

- 電力ノード \(\Rightarrow\) 通信ノード
  - 発電所・電力ノードは、遠隔監視・制御のために通信ノードに依存する。
- 通信ノード \(\Rightarrow\) 電力ノード
  - 通信ノードは、電力供給のために電力ノードに依存する。

いずれかが停止すると、相手も機能できない → 依存先も停止、とみなす。

### 3.2 依存リンクの構成ルール（実データ例）

イタリアの実データに基づく図 1 では、通信ノードと電力ノードの対応付けとして

- 「各インターネットサーバを、**地理的に最も近い電力ノード**に結びつける」

というルールが採用されていると説明されている（各サーバが最寄りの発電所に依存）。

この設定により：

- 地理的に離れたノード間には依存リンクが張られない。
- 空間的に近接するインフラ間で相互依存が強い状況を再現している。

本リポジトリの `build_real_italy_system` は、CSV `italy_dep_mapping.csv` を通じて

- `power_id, comm_id` のペアを読み込んで `dep_A_to_B`, `dep_B_to_A` を構成する。
- 実際のマッピングロジック（最近傍マッチング等）は前処理側に委ねるが、
  発想としては論文と同様に「近くの電力ノードに通信ノードをひも付ける」モデルを想定している。

### 3.3 実世界モデル vs 抽象モデル

Buldyrev2010 では、

- 特定のイタリア事例（地理付きネットワーク＋実データ）を用いた図解
- ER / スケールフリー / ランダムレギュラーネットワークなどの抽象モデル

の両方を扱っているが、相互依存関係の基本的なルールは共通している。

- 抽象モデル:
  - A/B ネットワークはランダムグラフとして生成。
  - 依存リンクもランダムに 1:1 対応させる。
- 実世界モデル（Italy case）:
  - ネットワーク構造や空間配置は実データに基づく。
  - 依存リンクは地理的近接などのルールで構成。

どちらも「2 層 + 1:1 依存 + percolation + カスケード」という枠組みで統一的に扱われる。

## 4. 実データ（例: Italy case）の構造

Buldyrev2010 自体は、データ形式（CSV の列名など）までは規定していないが、
本リポジトリでは以下のような形で Italy case を取り扱うことを想定している。

### 4.1 想定するデータファイル

- 電力ノード:
  - `data/raw/italy_power_nodes.csv`
  - 列例: `power_id`, `name`, `x`, `y`, ...
- 電力エッジ:
  - `data/raw/italy_power_edges.csv`
  - 列例: `src`, `dst`
- 通信ノード:
  - `data/raw/italy_comm_nodes.csv`
  - 列例: `comm_id`, `name`, `x`, `y`, ...
- 通信エッジ:
  - `data/raw/italy_comm_edges.csv`
  - 列例: `src`, `dst`
- 依存マッピング:
  - `data/raw/italy_dep_mapping.csv`
  - 列例: `power_id`, `comm_id`  
    （論文の「各通信ノードを地理的に最も近い電力ノードに接続する」ルールを反映したもの）

### 4.2 前処理・ID 設計

`build_real_italy_system` の仕様から、前処理では少なくとも次を満たす必要がある。

- ノード ID:
  - `power_id`, `comm_id` はそれぞれ `0..N-1` の連番である必要がある。
  - もし元データが任意の ID を持っている場合は、
    事前に `0..N-1` への再採番マッピングを構築する。
- エッジ整合性:
  - `power_edges` の `src`, `dst` は `power_id` の範囲内であること。
  - `comm_edges` の `src`, `dst` は `comm_id` の範囲内であること。
- 依存マッピング:
  - `italy_dep_mapping.csv` は
    - 各 `power_id` について少なくとも 1 つの `comm_id` を割り当てる（1:1 の場合はちょうど 1 つ）。
    - 各 `comm_id` についても同様。
  - `build_real_italy_system` 側では
    - `dep_A_to_B`, `dep_B_to_A` を長さ N の配列として構成し、
    - 欠損（未割当）がないかチェックする。

### 4.3 モデルとの対応関係のまとめ

- 論文中の「電力ネットワーク」「インターネット通信ネットワーク」は、
  本リポジトリでは `NetworkLayer("A")`, `NetworkLayer("B")` として表現される。
- 「イタリア大停電のカスケード」の例示は、
  - 実データ由来の A/B 層 + 依存リンク（`build_real_italy_system`）と、
  - 本リポジトリのカスケードエンジン（`run_cascade`）を組み合わせることで
  再現・拡張可能な枠組みとして整理されている。
